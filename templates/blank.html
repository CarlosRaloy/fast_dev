{% extends "base.html" %}
{% load static %}

{% block head_content %}
    <title>Demostraci√≥n de Librer√≠as</title>
{% endblock %}

{% block panel_page %}
    Demos <small>Demostracion de las librerias</small>
{% endblock %}

{% block panel_title %}
    Ventana de demos
{% endblock %}

{% block content %}

        <div class="container">
            <div class="row p-4">
                <div class="col-12">
                    <h1>Funciones que realiza el template</h1>
                </div>
            </div>
        </div>


    <div class="container mt-5">

        <!-- DataTables -->
        <h3>DataTables</h3>
        <table id="example" class="table table-bordered table-striped" style="width:100%">
            <thead>
            <tr>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Rol</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>Juan</td>
                <td>juan@example.com</td>
                <td>Admin</td>
            </tr>
            <tr>
                <td>Ana</td>
                <td>ana@example.com</td>
                <td>Editor</td>
            </tr>
            <tr>
                <td>Pedro</td>
                <td>pedro@example.com</td>
                <td>Usuario</td>
            </tr>
            </tbody>
        </table>

        <hr>

        <!-- SweetAlert2 -->
        <h3>SweetAlert2</h3>
        <button id="btn-alerta" class="btn btn-warning">Mostrar Alerta</button>

        <hr>

        <!-- Select2 -->
        <h3>Select2</h3>
        <select id="select-demo" class="form-select select2" style="width: 100%;">
            <option value="1">Opci√≥n A</option>
            <option value="2">Opci√≥n B</option>
            <option value="3">Opci√≥n C</option>
        </select>

        <hr>

        <!-- Awesomplete -->
        <h3>Awesomplete</h3>
        <input class="awesomplete form-control" list="sugerencias" placeholder="Escribe un lenguaje...">
        <datalist id="sugerencias">
            <option>Python</option>
            <option>Django</option>
            <option>JavaScript</option>
            <option>HTML</option>
            <option>CSS</option>
            <option>PHP</option>
            <option>Java</option>
            <option>C++</option>
            <option>C#</option>
            <option>Ruby</option>
            <option>C</option>
            <option>CoffeeScript</option>
            <option>Perl</option>
            <option>Go</option>
            <option>Scala</option>
            <option>R</option>
            <option>Lua</option>
            <option>Haskell</option>
            <option>Erlang</option>
            <option>Elixir</option>
            <option>OCaml</option>
            <option>Rust</option>
            <option>Swift</option>
            <option>Kotlin</option>
            <option>Dart</option>
            <option>Clojure</option>
            <option>Elixir</option>
            <option>Elm</option>
            <option>F#</option>
            <option>Haxe</option>
        </datalist>

        <hr>

        <!-- Datepicker -->
        <h3>Bootstrap Datepicker</h3>
        <input type="text" class="form-control datepicker" placeholder="Selecciona una fecha">

        <hr>

        <!-- Driver.js -->
        <h3>Driver.js (tour guiado)</h3>
        <button id="btn-tour" class="btn btn-info">Iniciar Tour</button>

        <hr>

        <!-- Interact.js -->
        <h3>Interact.js (arrastrar)</h3>
        <div id="drag-box"
             style="width:150px;height:150px;background:#4CAF50;color:#fff;display:flex;align-items:center;justify-content:center;cursor:move;">
            Arr√°strame
        </div>

    </div>

     <!-- ============================
             Puedes Borar el bloque completo
        ============================ -->

    <br><hr>
    <div class="container">
            <div class="row p-4">
                <div class="col-12">

                    <h1>Como funcionan los permisos en el template ?</h1>

             <h4 class="mt-3">üéöÔ∏è Niveles disponibles</h4>
                                <p>
                                    <b>Path:</b> <code>templates/sidebar.html</code> (o archivo donde est√© el men√∫ lateral)<br>
                                    Los niveles definen qu√© acciones puede realizar un usuario y qu√© elementos del men√∫ puede ver.
                                </p>

                                <ul>
                                    <li>
                                        <b>Nivel 0 - Bloqueado</b> <i class="fas fa-ban"></i><br/>
                                        Usuario restringido. Se ocultan secciones y puede ser enviado a la vista de bloqueo.
                                    </li>
                                    <li class="mt-2">
                                        <b>Nivel 1 - Usuario</b> <i class="fa-solid fa-user-plus"></i><br/>
                                        Usuario b√°sico. Acceso est√°ndar a las vistas comunes del sistema.
                                    </li>
                                    <li class="mt-2">
                                        <b>Nivel 2 - Admin</b> <i class="fa-solid fa-user-tie"></i><br/>
                                        Usuario administrador. Puede gestionar usuarios y acceder al panel administrativo.
                                    </li>
                                    <li class="mt-2">
                                        <b>Nivel 3 - Super / Secreto</b> <i class="fa-solid fa-user-secret"></i><br/>
                                        Nivel reservado para funciones especiales o futuras. Actualmente solo se muestra como etiqueta.
                                    </li>
                                </ul>

                                <hr>

                                <h4 class="mt-3">üß† ¬øC√≥mo funciona el bloqueo de secciones en el men√∫?</h4>
                                <p>
                                    <b>Path:</b> <code>templates/sidebar.html</code><br>
                                    Se utilizan clases CSS para ocultar secciones del sidebar seg√∫n el nivel del usuario.
                                </p>

                                <ul>
                                    <li><code>.logic_blocked</code> ‚Üí Se oculta cuando el usuario tiene <b>level 0</b></li>
                                    <li><code>.logic_user</code> ‚Üí Se oculta cuando el usuario tiene <b>level 1</b></li>
                                    <li><code>.logic_admin</code> ‚Üí Se oculta cuando el usuario tiene <b>level 2</b></li>
                                </ul>

                                <p><b>Ejemplo:</b></p>

                                <pre class="p-3 rounded"><code>{% verbatim %}

                .logic_blocked {
                    {% if request.user.profile.level == 0 %}
                        display: none !important;
                    {% endif %}
                }

                aplica en los --> class="has-sub <strong>logic_blocked</strong>"

                {% endverbatim %}</code></pre>

                                <p>
                                    Esto significa: Si el usuario tiene nivel <b>0</b>, cualquier elemento que tenga
                                    la clase <code>logic_blocked</code> desaparece del men√∫.
                                </p>

                                <hr>

                                <h4 class="mt-3">üîì ¬øC√≥mo se desbloquea un usuario?</h4>
                                <p>
                                    <b>Path:</b> <code>aplications/users/views.py</code><br>
                                    El nivel se modifica desde el panel admin (<code>user_panel</code>) o desde base de datos (solo soporte/pruebas).
                                </p>

                                <hr>

                                <h4 class="mt-3">üß≠ ¬øPor qu√© es importante la funci√≥n <code>_home_for()</code>?</h4>
                                <p>
                                    <b>Path:</b> <code>aplications/users/views.py</code><br>
                                    La funci√≥n <code>_home_for(user)</code> define la ruta de inicio a la que se redirige el usuario despu√©s del login,
                                    seg√∫n su nivel.
                                </p>

                                <p><b>Es importante por estas razones:</b></p>

                                <ul>
                                    <li>
                                        ‚úÖ <b>Centraliza la l√≥gica de redirecci√≥n</b><br>
                                        Evita repetir condicionales en m√∫ltiples vistas y mantiene el flujo consistente.
                                    </li>
                                    <li>
                                        ‚úÖ <b>Previene errores si el usuario no tiene profile o tiene un nivel inv√°lido</b><br>
                                        Usa <code>getattr</code> con valores por defecto para evitar fallas.
                                    </li>
                                    <li>
                                        ‚úÖ <b>Asegura una navegaci√≥n correcta aunque el frontend oculte elementos</b><br>
                                        El backend sigue siendo la autoridad de acceso.
                                    </li>
                                </ul>

                                <p><b>Ejemplo del c√≥digo:</b></p>

                                <pre class="p-3 rounded"><code>{% verbatim %}
                def _home_for(user) -> str:
                    profile = getattr(user, "profile", None)
                    level = getattr(profile, "level", 0)

                    if level == 0:
                        url_name = "users:ping"
                    elif level == 1:
                        url_name = "users:ping"
                    elif level == 2:
                        url_name = "users:ping"
                    else:
                        url_name = "users:block"

                    return reverse(url_name)
                {% endverbatim %}</code></pre>

                                <p class="mt-2">
                                    üìå <b>Nota:</b> Si en el futuro cada nivel tiene un dashboard distinto,
                                    este es el lugar correcto para definirlo y no duplicarlo en otros archivos.
                                </p>

                                <hr>


                            </div>
            </div>
    </div>

    <!-- ============================
             Puedes Borar el bloque completo
        ============================ -->
{% endblock %}

{% block scripts %}
    <script>

        // Datatables
        document.addEventListener('DOMContentLoaded', function () {
            new DataTable('#example', {
                responsive: true,
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
                },
                searchPanes: true,
                select: true,
                dom: 'Plfrtip'
            });
        });

        // SweetAlert2
        document.getElementById('btn-alerta').addEventListener('click', () => {
            Swal.fire({
                title: '¬°Hola!',
                text: 'Este es un mensaje con SweetAlert2',
                icon: 'success',
                confirmButtonText: 'Cerrar'
            });
        });

        // Select2
        $(document).ready(function () {
            $('#select-demo').select2();
        });

        // Datepicker
        $('.datepicker').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true
        });

        // Driver.js
        document.getElementById('btn-tour').addEventListener('click', () => {
            const driver = window.driver.js.driver;
            const tour = driver({
                showProgress: true,
                steps: [
                    {
                        element: '#tabla-demo',
                        popover: {title: 'DataTables', description: 'Esta tabla usa DataTables.', position: 'bottom'}
                    },
                    {
                        element: '#btn-alerta',
                        popover: {title: 'SweetAlert2', description: 'Bot√≥n con alerta personalizada.', position: 'top'}
                    },
                    {
                        element: '#select-demo',
                        popover: {title: 'Select2', description: 'Select con autocompletado.', position: 'top'}
                    },
                    {
                        element: '#drag-box',
                        popover: {title: 'Interact.js', description: 'Puedes arrastrar este cuadro.', position: 'top'}
                    }
                ]
            });
            tour.drive();
        });

        // Interact.js
        interact('#drag-box').draggable({
            listeners: {
                move(event) {
                    const target = event.target;
                    const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                    const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

                    target.style.transform = `translate(${x}px, ${y}px)`;
                    target.setAttribute('data-x', x);
                    target.setAttribute('data-y', y);
                }
            }
        });
    </script>
{% endblock %}
